 ~/Labs/l3vpn î‚° docker exec -it clab-l3vpn-R1 vtysh

Hello, this is FRRouting (version 9.0.1_git).
Copyright 1996-2005 Kunihiro Ishiguro, et al.

R1# sh ip int br
% Unknown command: sh ip int br
R1# sh int br
Interface       Status  VRF             Addresses
---------       ------  ---             ---------
blue            up      blue            
eth2            up      blue            10.0.11.1/30

Interface       Status  VRF             Addresses
---------       ------  ---             ---------
eth0            up      default         172.20.20.7/24
                                        + 2001:172:20:20::7/64
eth1            up      default         20.0.13.1/30
lo              up      default         1.1.1.1/32

Interface       Status  VRF             Addresses
---------       ------  ---             ---------
eth3            up      red             10.0.12.1/30
red             up      red             

R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
end
R1# 
R1# sh int br
Interface       Status  VRF             Addresses
---------       ------  ---             ---------
blue            up      blue            
eth2            up      blue            10.0.11.1/30

Interface       Status  VRF             Addresses
---------       ------  ---             ---------
eth0            up      default         172.20.20.7/24
                                        + 2001:172:20:20::7/64
eth1            up      default         20.0.13.1/30
lo              up      default         1.1.1.1/32

Interface       Status  VRF             Addresses
---------       ------  ---             ---------
eth3            up      red             10.0.12.1/30
red             up      red             

R1# 
R1# sh ip route ospf
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

O   1.1.1.1/32 [110/0] is directly connected, lo, weight 1, 00:40:47
O>* 2.2.2.2/32 [110/20] via 20.0.13.2, eth1, weight 1, 00:39:52
O>* 3.3.3.3/32 [110/10] via 20.0.13.2, eth1, weight 1, 00:40:03
O>* 4.4.4.4/32 [110/20] via 20.0.13.2, eth1, weight 1, 00:39:58
O>* 5.5.5.5/32 [110/30] via 20.0.13.2, eth1, weight 1, 00:39:53
O   20.0.13.0/30 [110/10] is directly connected, eth1, weight 1, 00:40:47
O>* 20.0.23.0/30 [110/20] via 20.0.13.2, eth1, weight 1, 00:40:03
O>* 20.0.34.0/30 [110/20] via 20.0.13.2, eth1, weight 1, 00:40:03
O>* 20.0.45.0/30 [110/30] via 20.0.13.2, eth1, weight 1, 00:39:58
R1# sh ip ospf 
  <cr>               
  (1-65535)          Instance ID
  border-routers     Show all the ABR's and ASBR's
  database           Database summary
  graceful-restart   OSPF Graceful Restart
  interface          Interface information
  json               JavaScript Object Notation
  mpls               MPLS information
  mpls-te            MPLS-TE information
  neighbor           Neighbor list
  reachable-routers  Show all the reachable OSPF routers
  route              OSPF routing table
  router-info        Router Information
  summary-address    Show external summary addresses
  vrf                Specify the VRF
  vrfs               Show OSPF VRFs 
R1# sh ip ospf database

       OSPF Router with ID (172.20.20.7)

                Router Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum  Link count
2.2.2.2        2.2.2.2          772 0x80000005 0xa71d 2
3.3.3.3        3.3.3.3          753 0x8000000d 0x8c3c 4
4.4.4.4        4.4.4.4          788 0x80000008 0x678c 3
172.20.20.2    172.20.20.2      785 0x80000005 0xc627 2
172.20.20.7    172.20.20.7      751 0x80000005 0x88ad 2

                Net Link States (Area 0.0.0.0)

Link ID         ADV Router      Age  Seq#       CkSum
20.0.13.1      172.20.20.7      791 0x80000002 0x5026
20.0.23.2      3.3.3.3          753 0x80000002 0xd638
20.0.34.2      4.4.4.4          798 0x80000002 0x9364
20.0.45.2      172.20.20.2      795 0x80000002 0x1e3d


(failed reverse-i-search)`': 
(failed reverse-i-search)`': 
R1# conf
R1(config)# 
R1(config)# mpld 
% There is no matched command.
R1(config)# mpls 
  label  Label configuration
  ldp    Label Distribution Protocol
  lsp    Establish label switched path
R1(config)# mpls ldp 
  <cr>  
R1(config)# mpls ldp 
R1(config-ldp)# end    
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 !
exit
!
end
R1# conf
R1(config)# 
R1(config)# mpls ldp
R1(config-ldp)# router-id 
  A.B.C.D  LSR Id (in form of an IPv4 address)
R1(config-ldp)# router-id 1.1.1.1 
  <cr>  
R1(config-ldp)# router-id 1.1.1.1 
R1(config-ldp)# address-family 
  ipv4  IPv4
  ipv6  IPv6
R1(config-ldp)# address-family ipv5 
% There is no matched command.
R1(config-ldp)# address-family ipv4 
  <cr>  
R1(config-ldp)# address-family ipv4 
R1(config-ldp-af)# discovery transport-address 1.1.1.1
R1(config-ldp-af)#           
  discovery            Configure discovery parameters
  end                  End current mode and change to enable mode
  exit                 Exit current mode and down to previous mode
  exit-address-family  Exit from Address Family configuration mode
  find                 Find CLI command matching a regular expression
  interface            Enable LDP on an interface and enter interface submode
  label                Configure label control and policies
  list                 Print command list
  neighbor             Configure neighbor parameters
  no                   Negate a command or set its defaults
  output               Direct vtysh output to file
  quit                 Exit current mode and down to previous mode
  session              Configure session parameters
  ttl-security         LDP ttl security check
R1(config-ldp-af)# interface   
  IFNAME  Interface's name
     blue eth2 eth0 eth1 lo eth3 red 
R1(config-ldp-af)# interface eth1 
  <cr>  
R1(config-ldp-af)# interface eth1 
R1(config-ldp-af-if)# exit
R1(config-ldp-af)# exit
R1(config-ldp)# exit
R1(config)# exit
R1# 
R1# 
R1# 
R1# show mpls ldp neighbor 
AF   ID              State       Remote Address    Uptime
ipv4 3.3.3.3         OPERATIONAL 3.3.3.3         00:01:53
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# conf
R1(config)# 
R1(config)# 
R1(config)# router bgp 400
R1(config-router)# neighbor 2.2.2.2 remote-as 400
R1(config-router)# neighbor 2.2.2.2 update-source lo 
R1(config-router)# no bgp ebgp-requires-policy 
R1(config-router)# neighbor 2.2.2.2 next-hop-self
R1(config-router)# neighbor 5.5.5.5 remote-as 400
R1(config-router)# neighbor 5.5.5.5 update-source lo
R1(config-router)# neighbor 5.5.5.5 next-hop-self
R1(config-router)# address-family ipv4 vpn 
R1(config-router-af)# neighbor 2.2.2.2 ac
accept-own  activate    
R1(config-router-af)# neighbor 2.2.2.2 activate
R1(config-router-af)# neighbor 5.5.5.5 activate
R1(config-router-af)# exit
R1(config-router)# exit
R1(config)# exit
R1# 
R1# 
R1# 
R1# clear ip bgp * soft
R1# 
R1# sh ip bgp 
  <cr>                  
  A.B.C.D               Network in the BGP routing table to display
  A.B.C.D/M             IPv4 prefix
  X:X::X:X              Network in the BGP routing table to display
  X:X::X:X/M            IPv6 prefix
  access-list           Display routes conforming to the access-list
  alias                 Display prefixes with matching BGP community alias
  all                   Display the entries for all address families
  attribute-info        List all bgp attribute information
  cidr-only             Display only routes with non-natural netmasks
  community             Display routes matching the communities
  community-info        List all bgp community information
  community-list        Community-list number
  dampening             Display detailed information about dampening
  detail                Detailed information
  detail-routes         Display detailed version of all routes
  filter-list           Display routes conforming to the filter-list
  import-check-table    BGP import check table
  ipv4                  Address Family
  ipv6                  Address Family
  json                  JavaScript Object Notation
  l2vpn                 Layer 2 Virtual Private Network
  large-community       Display routes matching the large-communities
  large-community-info  List all bgp large-community information
  large-community-list  Display routes matching the large-community-list
  memory                Global BGP memory statistics
  multicast             Address Family modifier
  neighbors             Detailed information on TCP and BGP neighbor connections
  nexthop               BGP nexthop table
  paths                 Path information
  peer-group            Detailed information on BGP peer groups
  prefix-list           Display routes conforming to the prefix-list
  regexp                Display routes matching the AS path regular expression
  route-leak            Route leaking information
  route-map             Display routes matching the route-map
  rpki                  RPKI route types
  self-originate        Display only self-originated routes
  statistics            BGP RIB advertisement statistics
  statistics-all        Display number of prefixes for all afi/safi
  summary               Summary of BGP neighbor status
  unicast               Address Family modifier
  update-groups         Detailed info about dynamic update groups
  version               Display prefixes with matching version numbers
  view                  BGP view
  views                 Show the defined BGP views
  vpn                   Address Family modifier
  vrf                   BGP VRF
  vrfs                  Show BGP VRFs
  wide                  Increase table width for longer prefixes
R1# sh ip bgp summary

IPv4 Unicast Summary (VRF default):
BGP router identifier 1.1.1.1, local AS number 400 vrf-id 0
BGP table version 0
RIB entries 0, using 0 bytes of memory
Peers 2, using 27 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
2.2.2.2         4        400        15        13        0    0    0 00:01:42            0        0 N/A
5.5.5.5         4        400        15        16        0    0    0 00:00:42            0        0 N/A

Total number of neighbors 2

IPv4 VPN Summary (VRF default):
BGP router identifier 1.1.1.1, local AS number 400 vrf-id 0
BGP table version 0
RIB entries 0, using 0 bytes of memory
Peers 2, using 27 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
2.2.2.2         4        400        15        13        0    0    0 00:01:42            0        0 N/A
5.5.5.5         4        400        15        16        0    0    0 00:00:42            0        0 N/A

Total number of neighbors 2
R1# 
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
R1# conf
R1(config)# 
R1(config)# router bgp 400 
  <cr>         
  as-notation  Force the AS notation output
  view         BGP view
  vrf          BGP VRF
R1(config)# router bgp 400 vrf 
  VIEWVRFNAME  View/VRF name
     blue default red 
R1(config)# router bgp 400 vrf blue
R1(config-router)# no bgp ebgp-requires-policy    
R1(config-router)# neighbor 10.0.11.2 remote-as 101
R1(config-router)# address-family ipv4 
  <cr>             
  flowspec         Address Family modifier
  labeled-unicast  Address Family modifier
  multicast        Address Family modifier
  unicast          Address Family modifier
  vpn              Address Family modifier
R1(config-router)# address-family ipv4 unicast 
R1(config-router-af)# neighbor 10.0.11.2 activate 
R1(config-router-af)# export vpn
R1(config-router-af)# import vpn
R1(config-router-af)# label     
  vpn  Between current address-family and vpn
R1(config-router-af)# label vpn 
  export  For routes leaked from current address-family to vpn
R1(config-router-af)# label vpn export 
  (0-1048575)      Label Value <0-1048575>
  allocation-mode  Label allocation mode
  auto             Automatically assign a label
R1(config-router-af)# label vpn export auto
R1(config-router-af)#  
  aggregate-address    Configure BGP aggregate entries
  bgp                  BGP Specific commands
  distance             Define an administrative distance
  end                  End current mode and change to enable mode
  exit                 Exit current mode and down to previous mode
  exit-address-family  Exit from Address Family configuration mode
  export               Export routes from this address-family
  find                 Find CLI command matching a regular expression
  import               Import routes to this address-family
  label                label value for VRF
  list                 Print command list
  maximum-paths        Forward packets over multiple paths
  neighbor             Specify neighbor router
  network              Specify a network to announce via BGP
  nexthop              Specify next hop to use for VRF advertised prefixes
  no                   Negate a command or set its defaults
  output               Direct vtysh output to file
  quit                 Exit current mode and down to previous mode
  rd                   Specify route distinguisher
  redistribute         Redistribute information from another routing protocol
  route-map            Specify route map
  route-target         Specify route target list
  route-target6        Specify route target list
  rt                   Specify route target list
  rt6                  Specify route target list
  sid                  sid value for VRF
  table-map            BGP table to RIB route download filter
R1(config-router-af)# rd 
  vpn  Between current address-family and vpn
R1(config-router-af)# rd               
  vpn  Between current address-family and vpn
R1(config-router-af)# rd von 
% There is no matched command.
R1(config-router-af)# rd vpn 
  export  For routes leaked from current address-family to vpn
R1(config-router-af)# rd vpn export 
  ASN:NN_OR_IP-ADDRESS:NN  Route Distinguisher (<as-number>:<number> | <ip-address>:<number>)
R1(config-router-af)# rd vpn export 400:101
R1(config-router-af)# route-target   
  redirect  Flow-spec redirect type route target
  vpn       Between current address-family and vpn
R1(config-router-af)# route-target vpn export 
  RTLIST  Space separated route target list (A.B.C.D:MN|EF:OPQR|GHJK:MN)
R1(config-router-af)# route-target vpn export 
  RTLIST  Space separated route target list (A.B.C.D:MN|EF:OPQR|GHJK:MN)
R1(config-router-af)# route-target vpn export 400:101
R1(config-router-af)# route-target vpn import 400:102
R1(config-router-af)# route-target vpn import 400:103
R1(config-router-af)# exit
R1(config-router)# exir
% Unknown command: exir
R1(config-router)# exit
R1(config)# end
R1# 
R1# 
R1# conf
R1(config)# 
R1(config)# 
R1(config)# router bgp 400
R1(config-router)# exit
R1(config)# router bgp 400 vrf 
  VIEWVRFNAME  View/VRF name
     blue default red 
R1(config)# router bgp 400 vrf red
R1(config-router)# neighbor 10.0.12.2 remote-as 201
R1(config-router)# no bgp ebgp-requires-policy 
R1(config-router)# address-family ipv4 
  <cr>             
  flowspec         Address Family modifier
  labeled-unicast  Address Family modifier
  multicast        Address Family modifier
  unicast          Address Family modifier
  vpn              Address Family modifier
R1(config-router)# address-family ipv4 unicast
R1(config-router-af)# neighbor 10.0.12.2 activate 
R1(config-router-af)# rd vpn export 400:201
R1(config-router-af)# route-target vpn export 400:201
R1(config-router-af)# route-target vpn import 
  RTLIST  Space separated route target list (A.B.C.D:MN|EF:OPQR|GHJK:MN)
R1(config-router-af)# route-target vpn import 400:203
R1(config-router-af)# export vpn
R1(config-router-af)# import vpn
R1(config-router-af)# label vpn export auto 
R1(config-router-af)# end
R1# 
R1# 
R1# 
R1# clear ip bgp * soft
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:101
  rt vpn import 400:103
  rt vpn export 400:101
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:201
  rt vpn import 400:203
  rt vpn export 400:201
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
R1# 
R1# 
R1# 
R1# sh ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 01:51:29
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 00:08:51
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:07:44
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:07:44
R1# show ip bgp vrf blue summary

IPv4 Unicast Summary (VRF blue):
BGP router identifier 10.0.11.1, local AS number 400 vrf-id 2
BGP table version 2
RIB entries 3, using 576 bytes of memory
Peers 1, using 13 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
10.0.11.2       4        101        14        14        2    0    0 00:09:54            1        2 N/A

Total number of neighbors 1
R1# ping 172.16.3.200
PING 172.16.3.200 (172.16.3.200): 56 data bytes
^C
--- 172.16.3.200 ping statistics ---
3 packets transmitted, 0 packets received, 100% packet loss
R1# ping 172.16.3.200 
  <cr>  
R1# ping 172.16.3.200 vrf 
% There is no matched command.
R1# ping vrf              
  <cr>  
R1# sh ip bgp summary

IPv4 Unicast Summary (VRF default):
BGP router identifier 1.1.1.1, local AS number 400 vrf-id 0
BGP table version 0
RIB entries 0, using 0 bytes of memory
Peers 2, using 27 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
2.2.2.2         4        400        62        61        0    0    0 00:39:39            0        0 N/A
5.5.5.5         4        400        63        64        0    0    0 00:38:39            0        0 N/A

Total number of neighbors 2

IPv4 VPN Summary (VRF default):
BGP router identifier 1.1.1.1, local AS number 400 vrf-id 0
BGP table version 0
RIB entries 9, using 1728 bytes of memory
Peers 2, using 27 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
2.2.2.2         4        400        62        61        1    0    0 00:39:39            1        2 N/A
5.5.5.5         4        400        63        64        1    0    0 00:38:39            2        2 N/A

Total number of neighbors 2
R1# sh run 
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:101
  rt vpn import 400:103
  rt vpn export 400:101
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:201
  rt vpn import 400:203
  rt vpn export 400:201
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
R1# 
R1# sh ip route
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 01:54:32
O   1.1.1.1/32 [110/0] is directly connected, lo, weight 1, 01:54:31
C>* 1.1.1.1/32 is directly connected, lo, 01:54:31
O>* 2.2.2.2/32 [110/20] via 20.0.13.2, eth1, label 17, weight 1, 01:53:36
O>* 3.3.3.3/32 [110/10] via 20.0.13.2, eth1, label implicit-null, weight 1, 01:53:47
O>* 4.4.4.4/32 [110/20] via 20.0.13.2, eth1, label 18, weight 1, 01:53:42
O>* 5.5.5.5/32 [110/30] via 20.0.13.2, eth1, label 19, weight 1, 01:53:37
O   20.0.13.0/30 [110/10] is directly connected, eth1, weight 1, 01:54:31
C>* 20.0.13.0/30 is directly connected, eth1, 01:54:31
O>* 20.0.23.0/30 [110/20] via 20.0.13.2, eth1, label implicit-null, weight 1, 01:53:47
O>* 20.0.34.0/30 [110/20] via 20.0.13.2, eth1, label implicit-null, weight 1, 01:53:47
O>* 20.0.45.0/30 [110/30] via 20.0.13.2, eth1, label 20, weight 1, 01:53:42
C>* 172.20.20.0/24 is directly connected, eth0, 01:54:32
R1# sh ip route vrf 
  NAME  The VRF name
     default blue red 
  all   All VRFs
R1# sh ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 01:54:36
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 00:11:58
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:10:51
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:10:51
R1# sh ip route vrf red 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF red:
C>* 10.0.12.0/30 is directly connected, eth3, 01:54:39
B>* 172.16.1.0/24 [20/0] via 10.0.12.2, eth3, weight 1, 00:10:17
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 145, weight 1, 00:09:46
  *                         via 20.0.13.2, eth1 (vrf default), label 19/145, weight 1, 00:09:46
R1# 
R1# 
R1# sh ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 02:01:02
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 00:18:24
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:17:17
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:17:17
R1# sh ip route vrf red 
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF red:
C>* 10.0.12.0/30 is directly connected, eth3, 02:01:05
B>* 172.16.1.0/24 [20/0] via 10.0.12.2, eth3, weight 1, 00:16:43
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 145, weight 1, 00:16:12
  *                         via 20.0.13.2, eth1 (vrf default), label 19/145, weight 1, 00:16:12
R1# 
R1# 
R1# 
R1# show ip bgp vrf blue summary

IPv4 Unicast Summary (VRF blue):
BGP router identifier 10.0.11.1, local AS number 400 vrf-id 2
BGP table version 2
RIB entries 3, using 576 bytes of memory
Peers 1, using 13 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
10.0.11.2       4        101        35        33        2    0    0 00:19:11            1        2 N/A

Total number of neighbors 1
R1# sh ip bgp vrf red summary

IPv4 Unicast Summary (VRF red):
BGP router identifier 10.0.12.1, local AS number 400 vrf-id 3
BGP table version 2
RIB entries 3, using 576 bytes of memory
Peers 1, using 13 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
10.0.12.2       4        201        33        31        2    0    0 00:17:10            1        2 N/A

Total number of neighbors 1
R1# 
R1# 
R1# sh ip bgp vrf red summary

IPv4 Unicast Summary (VRF red):
BGP router identifier 10.0.12.1, local AS number 400 vrf-id 3
BGP table version 2
RIB entries 3, using 576 bytes of memory
Peers 1, using 13 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
10.0.12.2       4        201        36        34        2    0    0 00:20:19            1        2 N/A

Total number of neighbors 1
R1# sh ip bgp vrf red summary   
R1# sh ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 02:04:45
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 00:22:07
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:21:00
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:21:00
R1# 
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:101
  rt vpn import 400:103
  rt vpn export 400:101
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:201
  rt vpn import 400:203
  rt vpn export 400:201
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
R1# 
R1# 
R1# sh ip route vrf red      
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF red:
C>* 10.0.12.0/30 is directly connected, eth3, 02:07:50
B>* 172.16.1.0/24 [20/0] via 10.0.12.2, eth3, weight 1, 00:23:28
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 145, weight 1, 00:22:57
  *                         via 20.0.13.2, eth1 (vrf default), label 19/145, weight 1, 00:22:57
R1# sh ip bgp vrf red summary   

IPv4 Unicast Summary (VRF red):
BGP router identifier 10.0.12.1, local AS number 400 vrf-id 3
BGP table version 2
RIB entries 3, using 576 bytes of memory
Peers 1, using 13 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
10.0.12.2       4        201        39        37        2    0    0 00:23:44            1        2 N/A

Total number of neighbors 1
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:101
  rt vpn import 400:103
  rt vpn export 400:101
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:201
  rt vpn import 400:203
  rt vpn export 400:201
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# clear ip bgp * soft
R1# 
R1# 
R1# show ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 02:13:44
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 00:31:06
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:29:59
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:29:59
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# sh ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 02:16:33
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 00:33:55
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:32:48
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:32:48
R1# 
R1# sh ip bgp vrf 
  VIEWVRFNAME  View/VRF name
     blue default red 
  all          All Views/VRFs
R1# sh ip bgp vrf blue
BGP table version is 2, local router ID is 10.0.11.1, vrf id 2
Default local pref 100, local AS 400
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

    Network          Next Hop            Metric LocPrf Weight Path
 *> 172.16.1.0/24    10.0.11.2                0             0 101 i
 *> 172.16.3.0/24    5.5.5.5@0<               0    100      0 103 i

Displayed  2 routes and 2 total paths
R1# 
R1# 
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:101
  rt vpn import 400:103
  rt vpn export 400:101
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:201
  rt vpn import 400:203
  rt vpn export 400:201
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# conf
R1(config)# 
R1(config)# router bgp 400 vrf blue
R1(config-router)# address-family ipv4  
  <cr>             
  flowspec         Address Family modifier
  labeled-unicast  Address Family modifier
  multicast        Address Family modifier
  unicast          Address Family modifier
  vpn              Address Family modifier
R1(config-router)# address-family ipv4 unicast 
R1(config-router-af)# no rd vpn export 400:101
R1(config-router-af)# route-target vpn 
  both    both import: match any and export: set
  export  For routes leaked from current address-family to vpn: set
  import  For routes leaked from vpn to current address-family: match any
R1(config-router-af)# no route-target vpn export 400:101
R1(config-router-af)# no route-target vpn import 400:103      
R1(config-router-af)# rd vpn export 
  ASN:NN_OR_IP-ADDRESS:NN  Route Distinguisher (<as-number>:<number> | <ip-address>:<number>)
R1(config-router-af)# rd vpn export 400:1
R1(config-router-af)# route-target vpn 
  both    both import: match any and export: set
  export  For routes leaked from current address-family to vpn: set
  import  For routes leaked from vpn to current address-family: match any
R1(config-router-af)# route-target vpn export 
  RTLIST  Space separated route target list (A.B.C.D:MN|EF:OPQR|GHJK:MN)
R1(config-router-af)# route-target vpn export 400:1
R1(config-router-af)# route-target vpn import 400:1
R1(config-router-af)# end
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:1
  rt vpn both 400:1
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:201
  rt vpn import 400:203
  rt vpn export 400:201
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
R1# 
R1# conf
R1(config)# router bgp 400 vrf red
R1(config-router)# address-family ipv4 unicast 
R1(config-router-af)# no rd vpn export 400:201
R1(config-router-af)# no route-target vpn export 400:201
R1(config-router-af)# no route-target vpn import 400:203
R1(config-router-af)# rd vpn export 400:2
R1(config-router-af)# route-target 
  redirect  Flow-spec redirect type route target
  vpn       Between current address-family and vpn
R1(config-router-af)# route-target vpn 
  both    both import: match any and export: set
  export  For routes leaked from current address-family to vpn: set
  import  For routes leaked from vpn to current address-family: match any
R1(config-router-af)# route-target vpn export 
  RTLIST  Space separated route target list (A.B.C.D:MN|EF:OPQR|GHJK:MN)
R1(config-router-af)# route-target vpn export 400:2
R1(config-router-af)# route-target vpn import 400:2
R1(config-router-af)# end
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:1
  rt vpn both 400:1
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:2
  rt vpn both 400:2
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
R1# 
R1# clear ip bgp * soft
R1# 
R1# 
R1# 
R1# sh ip route vrf blue
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

VRF blue:
C>* 10.0.11.0/30 is directly connected, eth2, 04:19:59
B>* 172.16.1.0/24 [20/0] via 10.0.11.2, eth2, weight 1, 02:37:21
B>  172.16.2.0/24 [200/0] via 2.2.2.2 (vrf default) (recursive), label 144, weight 1, 00:05:40
  *                         via 20.0.13.2, eth1 (vrf default), label 17/144, weight 1, 00:05:40
B>  172.16.3.0/24 [200/0] via 5.5.5.5 (vrf default) (recursive), label 144, weight 1, 00:04:38
  *                         via 20.0.13.2, eth1 (vrf default), label 19/144, weight 1, 00:04:38
R1# 
R1# sh ip bgp vrf blue summary

IPv4 Unicast Summary (VRF blue):
BGP router identifier 10.0.11.1, local AS number 400 vrf-id 2
BGP table version 5
RIB entries 5, using 960 bytes of memory
Peers 1, using 13 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
10.0.11.2       4        101       177       175        5    0    0 02:38:01            1        3 N/A

Total number of neighbors 1
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# 
R1# sh run
Building configuration...

Current configuration:
!
frr version 9.0.1_git
frr defaults traditional
hostname R1
no ipv6 forwarding
!
interface eth2
 ip address 10.0.11.1/30
exit
!
interface eth1
 ip address 20.0.13.1/30
 mpls enable
exit
!
interface lo
 ip address 1.1.1.1/32
 mpls enable
exit
!
interface eth3
 ip address 10.0.12.1/30
exit
!
router bgp 400
 no bgp ebgp-requires-policy
 neighbor 2.2.2.2 remote-as 400
 neighbor 2.2.2.2 update-source lo
 neighbor 5.5.5.5 remote-as 400
 neighbor 5.5.5.5 update-source lo
 !
 address-family ipv4 unicast
  neighbor 2.2.2.2 next-hop-self
  neighbor 5.5.5.5 next-hop-self
 exit-address-family
 !
 address-family ipv4 vpn
  neighbor 2.2.2.2 activate
  neighbor 5.5.5.5 activate
 exit-address-family
exit
!
router bgp 400 vrf blue
 no bgp ebgp-requires-policy
 neighbor 10.0.11.2 remote-as 101
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:1
  rt vpn both 400:1
  export vpn
  import vpn
 exit-address-family
exit
!
router bgp 400 vrf red
 no bgp ebgp-requires-policy
 neighbor 10.0.12.2 remote-as 201
 !
 address-family ipv4 unicast
  label vpn export auto
  rd vpn export 400:2
  rt vpn both 400:2
  export vpn
  import vpn
 exit-address-family
exit
!
router ospf
 network 1.1.1.1/32 area 0.0.0.0
 network 20.0.13.0/30 area 0.0.0.0
exit
!
mpls ldp
 router-id 1.1.1.1
 !
 address-family ipv4
  discovery transport-address 1.1.1.1
  !
  interface eth1
  exit
  !
 exit-address-family
 !
exit
!
end
R1# 
